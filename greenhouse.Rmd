---
title: "Greenhouse Gas Reporting Program Data"
author: "Laura Cech and Andrea Duran Liceaga"
date: "2023-Fall"
output: html_document
---

Intro: Given the ambitious goals of Maryland officials to reduce greenhouse gas emissions (by 60 percent by 2031), we propose to examine EPA data to answer fundamental questions:

1. How do greenhouse gas emissions in MD compare/ rank nationally? 
2. What are the locations of top greenhouse gas emitters?
3. How do the hotspots of emissions match with sites being supervised by state and federal environmental authorities? 
4. What are the demographics (median income, race) in areas with the most greenhouse emissions?
5. What industries/ companies emit the most and what are their parent companies? 

We believe these questions are newsworthy because they address some of the things people might want to know about how our state is doing regarding emissions.

Datasets come from: https://www.epa.gov/ghgreporting/data-sets

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
 
Deliverable 2:
Loads and cleans the core data set to prepare for analysis. 

Shows basic exploratory analysis to demonstrate an understanding of the dataset, including the number of rows and columns, any obvious limitations or flaws and any reasons why it might not be able to answer the questions you've posed last week.
-- We have loaded national and state data from EPA and census data. Based on our questions, we believe we have the data needed. We also may be interested in exploring additonal features of the FLIGHT dashboard.

Describe the limits of the data in terms of timeframe, what is and is not included and any codes or other information you'd need to find definitions for, and what you've done to better define it.
-- We found a good glossary (https://www.epa.gov/energy/greenhouse-gas-equivalencies-calculator) that translates the amount of emissions into real world effects.

## Load libraries and establish settings


```{r}
library(tidyverse)
library(sf)
library(janitor)
library(tigris)
library(tidycensus)
library(dplyr)
library(ggplot2)
library(mapview)

```


```{r}
#asked chatgpt for code to load one sheet of a spreadsheet
library(readxl) 

#This is the data from FLIGHT to look at emissions from the state of Maryland
md_emissions2022 <- read_excel("data/md_emissions_2022.xls", skip = 5) 
glimpse(md_emissions2022)

#this is getting the data from the Census API file for median income from 2021 by County in the state of Maryland.
census_api_key("77872777955b38b9334cbbae8eea25f316159387")

md_county_income <- get_acs(geography = "county",
              variables = c(medincome = "B19013_001"),
              year = 2021,
              state = "MD") |> 
  mutate(min = estimate - moe, max = estimate + moe) |> 
  glimpse()




```
```{r}
#to view largest to smallest quantity
md_emissions2022 <- md_emissions2022 |> 
  clean_names() |> 
  rename(ghg_quantity = ghg_quantity_metric_tons_co2e) |> 
  arrange(desc(ghg_quantity))
```

```{r}
#to compare Md and the rest of the nation
#read in summary file from EPA
national_emissions2022 <- read_excel("2022_data_summary_spreadsheets/ghgp_data_by_year_2022.xlsx", sheet = "Direct Emitters", skip = 3) 
glimpse(national_emissions2022)
```

Turn in, via GitHub, a draft of the data notebook you will produce for this project. You should work on this notebook together, but everyone needs to upload a copy to their own GitHub repo and turn in a link for grading. At a minimum, your data notebook should load the data you'll use with this project and have demonstrated work on at least two of the questions you are seeking to answer. The more you have finished, the more feedback I'll be able to give you. If you are having trouble with a question or thinking about changing/adding a question, let me know that in your notebook, too.


1. How do greenhouse gas emissions in MD compare/ rank nationally? 
Maryland is 37th in the ranking of all states and territories with Texas having the most emissions in 2022 and total facilities emitting greenhouse gas and DC having the least emissions and the Virgin Islands having the fewest facilities.

```{r}
national_filtered <- national_emissions2022 |>
   group_by(State) |>  
  summarise(count=n()) |>
  arrange(desc(count))
```

```{r}
#chat gpt helped troubleshoot error
total_emissions_per_state <- national_emissions2022 %>%
  group_by(State) %>%
  summarise(total_emissions = sum(`2022 Total reported direct emissions`, na.rm = TRUE)) |>
  arrange(desc(total_emissions))
```

2. What are the locations of top greenhouse gas emitters in Maryland?
There were 52 total facilities emitting greenhouse gas in 2022.
The top three GHG emitters are "Brandon Shores LLC", "LEHIGH CEMENT COMPANY LLC", and "Keys Energy Center" but a couple of the most interesting finds were University of Maryland that came in 18th out of 52 and Holcim (US), Inc. which is a building material manufacturer that is supposed to be a "global leader in sustainable construction" and works to "make greener infrastructure" but they are the 9th GHG emitter.

```{r}
locations_md <- md_emissions2022 |> 
  arrange(desc(ghg_quantity)) |> 
  mutate(zip_code = as.character(zip_code)) |> 
  glimpse()

counties <- counties()

glimpse(counties)
md_counties <- counties |>
  filter(STATEFP == "24")

map_md_emissions <- md_counties |> left_join(locations_md, by=c('NAMELSAD'='county_name'))

ggplot(locations_md, aes(x = longitude, y = latitude)) +
  geom_point() +
  labs(x = "longitude", y = "latitude") +
  ggtitle("Map of Latitude and Longitude")

ggplot(locations_md, aes(x = ghg_quantity, y = county_name)) +
    geom_point(color = "blue", size = 3) +
    labs(title = "Number of Calls by Income and Zipcode", x = "ghg_emissons", y = "county_name") +
    geom_text(aes(label = zip_code), check_overlap = TRUE)

ggplot() +
  geom_sf(data=locations_md, aes(fill=ghg_quantity)) +
  scale_colour_viridis_b(option="magma") +
  theme_minimal()

```

3. How do the hotspots of emissions match with sites being supervised by state and federal environmental authorities? 

```{r}
#Need help figuring out how to make the excel spreadsheet download
```

Alt 3. How have emissions in Maryland changed in the past decade?
There were 70 total facilities emitting greenhouse gas in 2012.
The top emitters in 2012 were Brandon Shores LLC, Morgantown and Chalk Point. University of Maryland was 63rd. In 2022, it climbed to number 18 out of 50.


```{r}
#filtering by quantity
md_emissions2012 <- read_excel("data/alldata.xls", sheet = "2012", skip = 5) 
glimpse(md_emissions2012)

md_emissions2012 |>
    clean_names() |> 
  rename(ghg_quantity = ghg_quantity_metric_tons_co2e) |> 
  arrange(desc(ghg_quantity))
```


4. What are the demographics (median income, race) in areas with the most greenhouse emissions in Maryland?

```{r}
md_emissions2022 |> group_by(county_name) |> 
  summarise(total_emissions = sum(ghg_quantity)) |>
  arrange(desc(total_emissions)) |> 
  mutate(county_name = str_to_title(str_remove_all(county_name,"COUNTY"))) |>
  mutate(county_name = str_trim(county_name,side="both")) |>
  #mutate(county_name = str_to_title(str_remove_all(county_name," CITY"))) |> 
  mutate(county_name = str_to_upper(county_name)) |> 
  #Prince George's County has duplicates and we need to figure out how to combine them. 2 extra PG Counties and 1 extra MoCo and 1 extra Harford.
  distinct()

md_county_income |> clean_names() |> 
  mutate(name = str_to_title(str_remove_all(name,"County, Maryland"))) |>
  mutate(name = str_to_title(str_remove_all(name, ", Maryland"))) |> 
  mutate(name = str_trim(name,side="both")) |>
  mutate(name = str_to_upper(name))

  
```



5. What industries/ companies emit the most and what are their parent companies? 

```{r}
<<<<<<< Updated upstream

```
=======
glimpse(md_emissions2022) #this will give us the parent companies. #use the subparts codes to find what industries the top emitters pertain to?

glimpse(national_emissions2022) #this will give us industry.
#both are for 2022

```

>>>>>>> Stashed changes

